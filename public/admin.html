<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>InterAc Admin - Quiz Management</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">  <!-- Restore the /interac/ prefix in the CSS path -->
  <link rel="stylesheet" href="/interac/client-side/client-styles/admin-styles.css">
  <!-- Link the new VA Modern Admin CSS -->  <link rel="stylesheet" href="/interac/client-side/client-styles/va-modern-admin.css">
  <!-- Batch UI Styles -->
  <link rel="stylesheet" href="/interac/client-side/client-styles/batch-ui.css">
  <!-- Question Review Styles -->
  <link rel="stylesheet" href="/interac/client-side/client-styles/question-review.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Using local Socket.IO file for consistency with index.html instead of CDN -->
  <script src="/interac/socket.io/socket.io.js"></script>
  <style>
    /* Enhanced styles for login modal with more vibrant colors and mobile-friendly design */
    #admin-login-container.modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(67, 97, 238, 0.9), rgba(247, 37, 133, 0.9));
      z-index: 1000;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(8px);
    }
    
    #admin-login-container.modal.active {
      display: flex !important;
      animation: fadeIn 0.5s ease-in-out;
    }
    
    /* General modal styling - for all modals */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(3px);
    }
    
    /* Large modal content */
    .modal-content.large {
      max-width: 800px;
      width: 90%;
    }

    /* Modal header and footer styling */
    .modal-header {
      padding: 15px 20px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #f8f9fa;
      border-radius: 10px 10px 0 0;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 18px;
      color: #333;
    }

    .modal-header .close-modal,
    .modal-header .close-preview-modal,
    .modal-header .close-edit-modal,
    .modal-header .close-similarity-modal {
      font-size: 22px;
      color: #64748b;
      cursor: pointer;
      background: none;
      border: none;
    }

    .modal-body {
      padding: 20px;
      max-height: 70vh;
      overflow-y: auto;
    }

    .modal-footer {
      padding: 15px 20px;
      border-top: 1px solid #e2e8f0;
      display: flex;
      justify-content: flex-end;
      background-color: #f8f9fa;
      border-radius: 0 0 10px 10px;
      gap: 10px;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25);
      overflow: hidden;
      width: 90%;
      max-width: 450px;
      animation: slideIn 0.6s cubic-bezier(0.23, 1, 0.32, 1);
      position: relative;
    }

    @keyframes slideIn {
      from { transform: translateY(-30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    #admin-login-container .modal-content {
      padding: 0;
      background: white;
      position: relative;
    }

    #admin-login-container .modal-content h2 {
      background: linear-gradient(to right, #4361ee, #f72585);
      color: white;
      padding: 1.8rem;
      margin: 0;
      text-align: center;
      font-size: 2rem;
      letter-spacing: 1px;
      border-radius: 20px 20px 0 0;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    #admin-login-container .modal-content input {
      width: 100%;
      padding: 1.2rem 1.5rem;
      margin: 1.2rem 0;
      border: none;
      background-color: rgba(247, 250, 252, 0.8);
      border-radius: 50px;
      font-size: 1rem;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
    }

    #admin-login-container .modal-content input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.3);
      background-color: white;
      transform: translateY(-2px);
    }

    #admin-login-container .form-wrapper {
      padding: 2.5rem;
    }

    #admin-login-btn {
      width: 100%;
      padding: 1.2rem;
      background: linear-gradient(to right, #4361ee, #f72585);
      color: white;
      border: none;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 1.5rem;
      box-shadow: 0 4px 15px rgba(67, 97, 238, 0.4);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    #admin-login-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(67, 97, 238, 0.5);
      background: linear-gradient(to right, #3a56d4, #e91e63);
    }

    #admin-login-btn:active {
      transform: translateY(-1px);
    }

    .error-message {
      color: #ef4444;
      margin-top: 15px;
      font-size: 0.9rem;
      text-align: center;
      background-color: rgba(239, 68, 68, 0.1);
      padding: 0.8rem;
      border-radius: 12px;
      display: none;
    }

    .error-message.show {
      display: block;
      animation: shake 0.5s;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }

    .form-icon {
      position: relative;
    }

    .form-icon i {
      position: absolute;
      top: 50%;
      left: 20px;
      transform: translateY(-50%);
      color: var(--primary-color);
      font-size: 1.2rem;
      transition: all 0.3s ease;
    }

    .form-icon input {
      padding-left: 55px !important;
    }
    
    .form-icon input:focus + i {
      color: #f72585;
      transform: translateY(-50%) scale(1.1);
    }

    .login-decoration {
      position: absolute;
      border-radius: 50%;
      z-index: -1;
    }

    .login-decoration.top-right {
      top: -50px;
      right: -50px;
      width: 200px;
      height: 200px;
      background: linear-gradient(135deg, rgba(67, 97, 238, 0.3), rgba(247, 37, 133, 0.3));
      animation: float 5s ease-in-out infinite;
    }

    .login-decoration.bottom-left {
      bottom: -60px;
      left: -60px;
      width: 220px;
      height: 220px;
      background: linear-gradient(135deg, rgba(247, 37, 133, 0.2), rgba(67, 97, 238, 0.2));
      animation: float 7s ease-in-out infinite reverse;
    }
    
    .login-decoration.middle-right {
      top: 50%;
      right: -40px;
      width: 120px;
      height: 120px;
      background: radial-gradient(circle, rgba(252, 70, 107, 0.15), rgba(63, 94, 251, 0.15));
      animation: float 6s ease-in-out infinite 1s;
    }

    @keyframes float {
      0% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-15px) rotate(5deg); }
      100% { transform: translateY(0) rotate(0deg); }
    }

    .login-title-accent {
      display: inline-block;
      position: relative;
    }
    
    .login-title-accent::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 5px;
      bottom: -5px;
      left: 0;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 10px;
    }

    /* Mobile responsiveness */
    @media (max-width: 480px) {
      #admin-login-container .modal-content {
        width: 95%;
        max-width: 350px;
      }

      #admin-login-container .modal-content h2 {
        font-size: 1.6rem;
        padding: 1.4rem;
      }
      
      #admin-login-container .form-wrapper {
        padding: 1.8rem;
      }
      
      #admin-login-container .modal-content input {
        padding: 1rem 1.2rem;
        font-size: 0.95rem;
        margin: 1rem 0;
      }
      
      #admin-login-btn {
        padding: 1rem;
        font-size: 1rem;
      }
      
      .login-decoration.top-right {
        width: 150px;
        height: 150px;
        top: -30px;
        right: -30px;
      }
      
      .login-decoration.bottom-left {
        width: 170px;
        height: 170px;
        bottom: -40px;
        left: -40px;
      }
      
      .login-decoration.middle-right {
        display: none;
      }
    }

    /* Improved styles for chat section (keeping existing chat styles) */
    .chat-container {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 180px);
      border-radius: 8px;
      overflow: hidden;
      background-color: #fff;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .chat-header {
      padding: 15px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #f8f9fa;
    }

    .chat-header h3 {
      margin: 0;
      font-size: 16px;
      color: #333;
    }

    .online-indicator {
      display: flex;
      align-items: center;
      font-size: 12px;
      color: #666;
    }

    .dot {
      width: 8px;
      height: 8px;
      background-color: #10b981;
      border-radius: 50%;
      margin-right: 5px;
    }

    .chat-messages {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      background-color: #fff;
    }

    .message {
      margin-bottom: 15px;
      display: flex;
      align-items: flex-start;
    }

    .message-content-wrapper {
      flex: 1;
    }

    .message-header {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
    }

    .message-sender {
      font-weight: 600;
      font-size: 14px;
      margin-right: 8px;
    }

    .message-time {
      font-size: 12px;
      color: #64748b;
    }

    .message-content {
      font-size: 14px;
      line-height: 1.5;
      color: #333;
      padding: 8px 12px;
      background-color: #f8f9fa;
      border-radius: 8px;
      display: inline-block;
      max-width: 80%;
    }

    .message.self .message-content {
      background-color: #3b82f6;
      color: white;
      margin-left: auto;
    }

    .system-message {
      text-align: center;
      margin: 15px 0;
      color: #64748b;
      font-size: 12px;
    }

    .system-message .message-content {
      background-color: #f1f5f9;
      color: #64748b;
      display: inline-block;
      padding: 5px 10px;
      border-radius: 8px;
    }

    .chat-input-container {
      padding: 15px;
      border-top: 1px solid #e2e8f0;
      background-color: #fff;
      display: flex;
      gap: 10px;
    }

    #chat-input {
      flex: 1;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      padding: 10px;
      outline: none;
      font-family: inherit;
      font-size: 14px;
    }

    #chat-input:focus {
      border-color: #3b82f6;
    }

    #send-message-btn {
      padding: 6px 15px;
      background-color: #3b82f6;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #send-message-btn:hover {
      background-color: #2563eb;
    }

    .users-online-list {
      padding: 10px 15px;
      border-bottom: 1px solid #e2e8f0;
      background-color: #f8f9fa;
      max-height: 100px;
      overflow-y: auto;
    }

    .users-online-list-title {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 5px;
    }

    .users-online-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }

    .user-pill {
      background-color: #e9ecef;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 12px;
      color: #4b5563;
    }

    .mt-4 {
      margin-top: 16px;
    }

    .admin-card .chat-container {
      margin-top: 15px;
    }

    /* Tab styles for modal */
    .form-tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid #e2e8f0;
    }

    .tab-btn {
      padding: 10px 20px;
      background: none;
      border: none;
      cursor: pointer;
      font-weight: 500;
      color: #64748b;
      position: relative;
    }

    .tab-btn.active {
      color: #3b82f6;
      font-weight: 600;
    }

    .tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 100%;
      height: 2px;
      background-color: #3b82f6;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Form styling */
    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #333;
    }

    .form-group input[type="text"],
    .form-group input[type="number"],
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.2s;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    .form-row {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }

    .form-group.half {
      flex: 1;
      margin-bottom: 0;
    }

    /* VA Modern Quiz Modal styles */
    .va-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1001;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(5px);
    }

    .va-modal-content {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      overflow: hidden;
      width: 90%;
      max-width: 600px;
      animation: slideIn 0.4s ease-out;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .va-modal-header {
      padding: 15px 20px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #f8f9fa;
    }

    .va-modal-header h2 {
      margin: 0;
      font-size: 18px;
      color: #333;
    }

    .va-close-btn {
      font-size: 22px;
      color: #64748b;
      cursor: pointer;
      background: none;
      border: none;
    }

    .va-modal-body {
      padding: 20px;
      max-height: 70vh;
      overflow-y: auto;
    }

    .va-stepper {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .va-step {
      flex: 1;
      padding: 10px;
      text-align: center;
      font-weight: 500;
      color: #64748b;
      cursor: pointer;
      position: relative;
    }

    .va-step.active {
      color: #3b82f6;
      font-weight: 600;
    }

    .va-step.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 2px;
      background-color: #3b82f6;
    }

    .va-step-content {
      display: none;
    }

    .va-step-content.active {
      display: block;
    }

    /* Toast styles */
    .va-toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #fff;
      color: #333;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      z-index: 1002;
      display: none;
    }

    .va-toast.show {
      display: block;
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body>
  <!-- Admin Login Modal - Enhanced with icons and design elements -->
  <div id="admin-login-container" class="modal">
    <div class="modal-content">
      <div class="login-decoration top-right"></div>
      <div class="login-decoration bottom-left"></div>
      <div class="login-decoration middle-right"></div>
      <h2><span class="login-title-accent">Admin</span> Login</h2>
      <div class="form-wrapper">
        <div class="form-icon">
          <input type="text" id="admin-username" placeholder="Username" required>
          <i class="fas fa-user"></i>
        </div>
        <div class="form-icon">
          <input type="password" id="admin-password" placeholder="Password" required>
          <i class="fas fa-lock"></i>
        </div>
        <button id="admin-login-btn">Sign In</button>
        <div id="admin-login-error" class="error-message"></div>
      </div>
    </div>
  </div>

  <div class="admin-container" style="display:none;">
    <nav class="admin-nav">
      <div class="nav-logo">InterAc Admin</div>
      <div class="nav-menu">
        <span class="menu-item active" data-view="quizzes">Quizzes</span>
        <span class="menu-item" data-view="users">Users</span>
        <span class="menu-item" data-view="stats">Statistics</span>
        <span class="menu-item" data-view="chat">Chat</span>
      </div>
      <button id="logout-btn" class="btn-outline">Logout</button>
    </nav>

    <div class="admin-content">
      <!-- Quizzes View -->
      <div id="quizzes-view" class="admin-view active">
        <div class="admin-header">          <h2>Quiz Management</h2>
          <div>
            <button id="new-quiz-designer-btn" class="btn"><i class="fas fa-plus-circle"></i> Design New Quiz</button>
          </div>
        </div>
        
        <div class="admin-card">
          <div class="filter-controls">
            <div class="search-container">
              <input type="text" id="quiz-search" placeholder="Search quizzes...">
              <i class="fas fa-search"></i>
            </div>
            <div class="filter-dropdown">
              <select id="quiz-filter">
                <option value="all">All Quizzes</option>
                <option value="active">Active</option>
                <option value="draft">Draft</option>
              </select>
            </div>
          </div>C
          
          <table class="data-table" id="quizzes-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Questions</th>
                <th>Created</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Quiz data will be loaded here -->
            </tbody>
          </table>
          
          <div class="pagination">
            <button class="pagination-btn" id="prev-page"><i class="fas fa-chevron-left"></i></button>
            <span id="page-info">Page 1 of 1</span>
            <button class="pagination-btn" id="next-page"><i class="fas fa-chevron-right"></i></button>
          </div>
        </div>
      </div>
      
      <!-- Users View -->
      <div id="users-view" class="admin-view">
        <div class="admin-header">
          <h2>User Management</h2>
        </div>
        <!-- User management content here -->
      </div>
      
      <!-- Stats View -->
      <div id="stats-view" class="admin-view">
        <div class="admin-header">
          <h2>Statistics</h2>
        </div>
        <!-- Statistics content here -->
      </div>
      
      <!-- Chat View - Updated to simplified chat interface -->
      <div id="chat-view" class="admin-view">
        <div class="admin-header">
          <h2>Chat Management</h2>
        </div>
        <div class="admin-card">
          <div class="chat-container">
            <div class="chat-header">
              <h3>Admin Chat</h3>
              <div class="online-indicator">
                <span class="dot"></span>
                <span id="online-count">0</span> users online
              </div>
            </div>
            
            <div class="users-online-list">
              <div class="users-online-list-title">Online Users:</div>
              <div class="users-online-pills" id="online-users-list">
                <!-- User pills will be added here dynamically -->
              </div>
            </div>
            
            <div class="chat-messages" id="chat-messages">
              <!-- Messages will be populated here -->
              <div class="system-message">
                <div class="message-content">
                  Welcome to the admin chat. This is the beginning of the conversation.
                </div>
              </div>
            </div>
            
            <div class="chat-input-container">
              <input type="text" id="chat-input" placeholder="Type your message here...">
              <button id="send-message-btn">Send</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Quiz Designer Modal -->
  <div id="quiz-designer-modal" class="modal">
    <div class="modal-content large">
      <div class="modal-header">
        <h2>Design New Quiz</h2>
        <span class="close-designer-modal">&times;</span>
      </div>
      
      <div class="modal-body quiz-designer-body">
        <!-- Quiz Builder Sidebar -->
        <div class="quiz-designer-sidebar">
          <div class="quiz-info-section">
            <h3>Quiz Information</h3>
            <div class="form-group">
              <label for="designer-quiz-name">Quiz Name</label>
              <input type="text" id="designer-quiz-name" placeholder="Enter a clear and descriptive name">
            </div>
            
            <div class="form-group">
              <label for="designer-quiz-description">Description</label>
              <textarea id="designer-quiz-description" placeholder="Briefly describe what this quiz covers"></textarea>
            </div>
            
            <div class="form-group">
              <label for="designer-time-per-question">Time per Question (seconds)</label>
              <input type="number" id="designer-time-per-question" min="10" value="30">
            </div>
          </div>
          
          <div class="generation-options-section">
            <h3>Generation Options</h3>
            <div class="form-group">
              <label for="designer-generation-method">Content Source</label>
              <div class="generation-method-selector">
                <button class="method-option active" data-method="ai">AI Generated</button>
                <button class="method-option" data-method="manual">Manual Entry</button>
              </div>
            </div>
            
            <!-- AI Generation Options -->
            <div id="ai-generation-options" class="generation-option-section active">
              <div class="form-group focus-container">
                <label for="designer-ai-topic">Topic/Prompt</label>
                <textarea id="designer-ai-topic" placeholder="Describe the topic for your quiz questions"></textarea>
              </div>
              
              <div class="form-row">
                <div class="form-group half">
                  <label for="designer-question-count">Number of Questions</label>
                  <div class="custom-number-input">
                    <button type="button" class="number-btn decrease">-</button>
                    <input type="number" id="designer-question-count" min="5" max="50" value="10">
                    <button type="button" class="number-btn increase">+</button>
                  </div>
                </div>
                
                <div class="form-group half">
                  <label for="designer-difficulty">Difficulty</label>
                  <select id="designer-difficulty">
                    <option value="easy">Easy</option>
                    <option value="medium" selected>Medium</option>
                    <option value="hard">Hard</option>
                    <option value="mixed">Mixed</option>
                  </select>
                </div>
              </div>
              
              <div class="form-group">
                <label for="designer-options-per-question">Options per Question</label>
                <select id="designer-options-per-question">
                  <option value="2">2 options</option>
                  <option value="3">3 options</option>
                  <option value="4" selected>4 options</option>
                  <option value="5">5 options</option>
                  <option value="6">6 options</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="designer-tone">Explanation Style</label>
                <select id="designer-tone">
                  <option value="educational" selected>Educational</option>
                  <option value="encouraging">Encouraging</option>
                  <option value="concise">Concise</option>
                  <option value="detailed">Detailed</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="designer-specific-focuses">Specific Focus Areas (optional)</label>
                <textarea id="designer-specific-focuses" placeholder="List specific concepts to focus on, separated by commas"></textarea>
              </div>
            </div>
            
            <!-- Manual Entry Options -->
            <div id="manual-entry-options" class="generation-option-section">
              <p class="helper-text">Add questions manually using the editor on the right side.</p>
              <button id="add-new-question-btn" class="btn-outline">Add New Question</button>
            </div>
          </div>
        </div>
        
        <!-- Question Preview and Editor Area -->
        <div class="quiz-designer-content">
          <!-- Content tabs -->
          <div class="designer-tabs">
            <button class="designer-tab-btn active" data-tab="editor">Question Editor</button>
            <button class="designer-tab-btn" data-tab="preview">Quiz Preview</button>
          </div>
          
          <!-- Question Editor Tab -->
          <div id="question-editor-tab" class="designer-tab-content active">
            <div class="question-list-header">
              <h3>Questions</h3>
              <div class="question-controls">
                <div id="question-count-display">0 questions</div>
                <button id="generate-questions-btn" class="btn">Generate Questions</button>
              </div>
            </div>
            
            <div id="questions-editor-container" class="questions-editor-container">
              <div class="empty-state">
                <img src="https://cdn-icons-png.flaticon.com/512/7486/7486754.png" alt="Empty questions" width="120">
                <h3>No Questions Yet</h3>
                <p>Generate questions using AI or add them manually</p>
              </div>
              
              <!-- Questions will be listed here -->
            </div>
          </div>
          
          <!-- Preview Tab -->
          <div id="quiz-preview-tab" class="designer-tab-content">
            <div class="preview-container">
              <div class="quiz-preview-header">
                <h3>Quiz Preview</h3>
                <div class="preview-meta">
                  <span id="preview-question-count">0 questions</span> | 
                  <span id="preview-time-per-question">30s per question</span>
                </div>
              </div>
              
              <div id="quiz-preview-container" class="quiz-preview-content">
                <!-- Preview content will be generated here -->
                <div class="empty-preview">
                  <p>Add questions to see a preview of your quiz</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer designer-footer">
        <div class="designer-actions">
          <button id="cancel-designer-btn" class="btn-outline">Cancel</button>
          <button id="save-quiz-draft-btn" class="btn-outline">Save as Draft</button>
          <button id="publish-quiz-btn" class="btn">Save & Publish Quiz</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Question Editor Modal -->
  <div id="question-editor-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Question</h2>
        <span class="close-question-editor-modal">&times;</span>
      </div>
      
      <div class="modal-body">
        <div class="form-group">
          <label for="edit-question-text">Question Text</label>
          <textarea id="edit-question-text" placeholder="Enter your question"></textarea>
        </div>
        
        <div id="edit-options-container" class="edit-options-container">
          <!-- Options will be added here -->
          <div class="option-row">
            <div class="option-correct">
              <input type="radio" name="correct-option" id="option-correct-0" checked>
            </div>
            <div class="option-text-container">
              <input type="text" class="option-text" placeholder="Option 1">
            </div>
            <div class="option-actions">
              <button class="remove-option-btn"><i class="fas fa-times"></i></button>
            </div>
          </div>
        </div>
        
        <button id="add-option-btn" class="btn-outline btn-sm">Add Option</button>
        
        <div class="form-group">
          <label for="edit-rationale">Explanation</label>
          <textarea id="edit-rationale" placeholder="Explain why the correct answer is right"></textarea>
        </div>
      </div>
      
      <div class="modal-footer">
        <button id="cancel-edit-question-btn" class="btn-outline">Cancel</button>
        <button id="save-question-btn" class="btn">Save Question</button>
      </div>
    </div>
  </div>
  
  <!-- Generation Progress Modal -->
  <div id="new-generation-progress-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Generating Quiz Questions</h2>
      </div>
      
      <div class="modal-body">
        <div class="modern-progress-container">
          <div class="progress-circle-container">
            <div class="progress-circle">
              <div class="progress-circle-inner">
                <div id="progress-percentage">0%</div>
                <div class="progress-label">Complete</div>
              </div>
            </div>
          </div>
          
          <div class="progress-stats">
            <div class="progress-stat-item">
              <div class="stat-label">Questions</div>
              <div class="stat-value" id="questions-generated-count">0/10</div>
            </div>
            <div class="progress-stat-item">
              <div class="stat-label">Time Elapsed</div>
              <div class="stat-value" id="generation-time-elapsed">00:00</div>
            </div>
            <div class="progress-stat-item">
              <div class="stat-label">Est. Remaining</div>
              <div class="stat-value" id="generation-time-remaining">--:--</div>
            </div>
          </div>
        </div>
        
        <div class="generation-details">
          <h3>Generation Progress</h3>
          <div class="generation-progress-log" id="generation-progress-log">
            <div class="log-entry">Preparing to generate questions...</div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button id="cancel-generation-btn" class="btn-outline">Cancel</button>
      </div>
    </div>
  </div>
  
  <!-- Quiz Preview Modal -->
  <div id="quiz-preview-modal" class="modal">
    <div class="modal-content large">
      <div class="modal-header">
        <h2>Quiz Preview</h2>
        <span class="close-preview-modal">&times;</span>
      </div>
      
      <div class="modal-body">
        <div class="quiz-info">
          <h3 id="preview-quiz-name">Quiz Name</h3>
          <p id="preview-quiz-description">Quiz description will appear here</p>
          <div class="quiz-meta">
            <span id="preview-quiz-questions">10 Questions</span>
            <span id="preview-quiz-time">30s per question</span>
          </div>
        </div>
        
        <div id="preview-questions-container">
          <!-- Questions will be displayed here -->
        </div>
      </div>
      
      <div class="modal-footer">
        <button id="edit-quiz-btn" class="btn-outline">Edit Quiz</button>
        <button id="publish-quiz-btn" class="btn">Publish Quiz</button>
      </div>
    </div>
  </div>
  
  <!-- Edit Question Modal -->
  <div id="edit-question-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Question</h2>
        <span class="close-edit-modal">&times;</span>
      </div>
      
      <div class="modal-body">
        <div class="form-group">
          <label for="edit-question-text">Question Text</label>
          <textarea id="edit-question-text" placeholder="Enter question text"></textarea>
        </div>
        
        <div id="edit-options-container">
          <!-- Options will be added here -->
        </div>
        
        <button id="add-option-btn" class="btn-sm">Add Option</button>
        
        <div class="form-group">
          <label for="edit-question-rationale">Rationale</label>
          <textarea id="edit-question-rationale" placeholder="Explain why the correct answer is right"></textarea>
        </div>
      </div>
      
      <div class="modal-footer">
        <button id="regenerate-question-btn" class="btn-outline">Regenerate with AI</button>
        <button id="save-question-btn" class="btn">Save Changes</button>
      </div>
    </div>
  </div>
  
  <!-- Similarity Check Modal -->
  <div id="similarity-check-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Question Similarity Check</h2>
        <span class="close-similarity-modal">&times;</span>
      </div>
      
      <div class="modal-body">
        <div class="result-container" id="similarity-results">
          <!-- Similarity results will be displayed here -->
        </div>
      </div>
      
      <div class="modal-footer">
        <button id="close-similarity-btn" class="btn">Close</button>
      </div>
    </div>
  </div>
  
  <!-- Modern VA Quiz Modal -->
  <div id="va-quiz-modal" class="va-modal" style="display:none;">
    <div class="va-modal-content">
      <div class="va-modal-header">
        <h2 id="va-modal-title">Create New Quiz</h2>
        <button class="va-close-btn" id="va-close-modal">&times;</button>
      </div>
      <div class="va-modal-body">
        <div class="va-stepper">
          <div class="va-step active" data-step="1">1. Details</div>
          <div class="va-step" data-step="2">2. Questions</div>
          <div class="va-step" data-step="3">3. Review</div>
        </div>
        <!-- Step 1: Details -->
        <form id="va-quiz-details-step" class="va-step-content active">
          <label>Quiz Title
            <input type="text" id="va-quiz-title" required maxlength="100" />
          </label>
          <label>Description
            <textarea id="va-quiz-description" maxlength="300"></textarea>
          </label>
          <label>Context / Topic
            <input type="text" id="va-quiz-context" maxlength="150" placeholder="e.g. US History, Algebra, Safety Procedures" />
          </label>
          <label>Time per Question (seconds)
            <input type="number" id="va-quiz-time" min="10" max="300" value="30" />
          </label>
          <label>Tags
            <input type="text" id="va-quiz-tags" placeholder="comma separated" />
          </label>
        </form>
        <!-- Step 2: Questions -->
        <div id="va-quiz-questions-step" class="va-step-content">
          <div class="va-question-controls">
            <button type="button" class="va-btn va-secondary" id="va-add-question-btn">Add Question</button>
            <button type="button" class="va-btn va-primary" id="va-ai-generate-btn">AI Generate</button>
          </div>
          <div id="va-questions-list"></div>
        </div>
        <!-- Step 3: Review -->
        <div id="va-quiz-review-step" class="va-step-content">
          <div id="va-review-list"></div>
          <button type="button" class="va-btn va-warning" id="va-similarity-btn">Check Similarity</button>
        </div>
      </div>
      <div class="va-modal-footer">
        <button class="va-btn va-secondary" id="va-back-step-btn">Back</button>
        <button class="va-btn va-primary" id="va-next-step-btn">Next</button>
        <button class="va-btn va-success" id="va-save-quiz-btn" style="display:none;">Save Quiz</button>
      </div>
    </div>
  </div>
  <!-- Toast for similarity results -->
  <div id="va-toast" class="va-toast"></div>
    <!-- Restore the /interac/ prefix in the JavaScript path -->
  <script src="/interac/client-side/admin/admin-main.js" type="module"></script>
  <script src="/interac/client-side/admin/quiz-designer.js" type="module"></script>
  
  <!-- Socket.IO Integration -->
  <script type="module">
    // Import socket client and storage utilities
    import socketClient from '/interac/client-side/client-socket/socket-client.js';
    import { 
      getUserIdentityFromCookie, 
      setUserIdentityCookie, 
      removeUserIdentityCookie 
    } from '/interac/client-side/client-utils/storage-utils.js';
    
    // Function to update connection status UI
    function updateConnectionStatus(isConnected) {
      const onlineIndicator = document.querySelector('.dot');
      
      if (isConnected) {
        onlineIndicator.style.backgroundColor = '#10b981'; // Green for connected
      } else {
        onlineIndicator.style.backgroundColor = '#ef4444'; // Red for disconnected
      }
    }
    
    // Handle admin login
    document.addEventListener('DOMContentLoaded', function() {
      const adminLoginBtn = document.getElementById('admin-login-btn');
      const adminLoginError = document.getElementById('admin-login-error');
      const adminLoginContainer = document.getElementById('admin-login-container');
      const adminContainer = document.querySelector('.admin-container');
      const logoutBtn = document.getElementById('logout-btn');
      
      // Show login modal on page load
      adminLoginContainer.classList.add('active');
      
      // Admin login handler
      if (adminLoginBtn) {
        adminLoginBtn.addEventListener('click', async function() {
          const usernameInput = document.getElementById('admin-username');
          const passwordInput = document.getElementById('admin-password');
          
          if (!usernameInput.value.trim()) {
            adminLoginError.textContent = 'Please enter a username';
            return;
          }
          
          // Disable button during login attempt
          adminLoginBtn.disabled = true;
          adminLoginBtn.textContent = 'Logging in...';
          adminLoginError.textContent = '';
          
          try {
            // Check for existing identity cookie
            const storedIdentity = getUserIdentityFromCookie();
            let isReturningUser = false;
            
            if (storedIdentity && storedIdentity.username === usernameInput.value.trim()) {
              console.log('Detected returning admin with matching cookie identity');
              isReturningUser = true;
            }
            
            // Connect to socket server with admin role
            const username = `admin_${usernameInput.value.trim()}`;
            const connected = socketClient.connectWithUsername(username);
            
            if (!connected) {
              throw new Error('Failed to connect to server');
            }
            
            // Wait for connection confirmation
            await new Promise((resolve, reject) => {
              // Set a timeout for connection attempt
              const timeout = setTimeout(() => {
                reject(new Error('Connection timeout'));
              }, 5000);
              
              // Listen for connect event
              socketClient.socket.once('connect', () => {
                clearTimeout(timeout);
                // Emit admin authentication event
                socketClient.socket.emit('admin:authenticate', {
                  username: usernameInput.value.trim(),
                  password: passwordInput.value,
                  isReturningUser
                });
                
                // Listen for authentication response
                socketClient.socket.once('admin:auth_result', (result) => {
                  if (result.success) {
                    resolve(result);
                  } else {
                    reject(new Error(result.message || 'Authentication failed'));
                  }
                });
              });
              
              // Listen for connect_error event
              socketClient.socket.once('connect_error', (err) => {
                clearTimeout(timeout);
                reject(new Error(err.message || 'Connection error'));
              });
            });
            
            // Store admin info in cookie
            setUserIdentityCookie(username, socketClient.userId);
            
            // Hide login modal, show admin container
            adminLoginContainer.classList.remove('active');
            adminContainer.style.display = '';
            
            // Update connection status
            updateConnectionStatus(true);
            
            // Set up socket event handlers
            setupSocketEvents();
            
          } catch (error) {
            console.error('Login error:', error);
            adminLoginError.textContent = error.message || 'Authentication failed. Please try again.';
            
            // Disconnect socket on failed login
            socketClient.disconnect();
          } finally {
            // Re-enable login button
            adminLoginBtn.disabled = false;
            adminLoginBtn.textContent = 'Login';
          }
        });
      }
      
      // Logout handler
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
          // Disable logout button to prevent multiple clicks
          logoutBtn.disabled = true;
          logoutBtn.textContent = 'Logging out...';
          
          // Clean disconnect from socket
          socketClient.disconnect();
          
          // Reset any persistent data
          removeUserIdentityCookie();
          localStorage.removeItem('admin_auth');
          sessionStorage.clear();
          
          // Update UI
          setTimeout(() => {
            // Show login container, hide admin container
            adminLoginContainer.classList.add('active');
            adminContainer.style.display = 'none';
            
            // Clear the login form
            document.getElementById('admin-username').value = '';
            document.getElementById('admin-password').value = '';
            
            // Re-enable the logout button
            logoutBtn.disabled = false;
            logoutBtn.textContent = 'Logout';
          }, 500);
        });
      }
    });
    
    // Set up socket event handlers
    function setupSocketEvents() {
      const socket = socketClient.getSocket();
      const onlineCountElement = document.getElementById('online-count');
      const onlineUsersList = document.getElementById('online-users-list');
      const chatMessages = document.getElementById('chat-messages');
      const chatInput = document.getElementById('chat-input');
      const sendMessageBtn = document.getElementById('send-message-btn');
      
      // Handle connection events
      socket.on('connect', () => {
        updateConnectionStatus(true);
        // Add system message for connection
        addSystemMessage('Connected to server');
      });
      
      socket.on('disconnect', () => {
        updateConnectionStatus(false);
        // Add system message for disconnection
        addSystemMessage('Disconnected from server');
      });
      
      socket.on('reconnect', (attemptNumber) => {
        updateConnectionStatus(true);
        // Add system message for reconnection
        addSystemMessage(`Reconnected after ${attemptNumber} attempts`);
      });
      
      // Handle user events
      socket.on('users:update', (users) => {
        // Update online users count
        if (onlineCountElement) {
          onlineCountElement.textContent = users.length;
        }
        
        // Update online users list
        if (onlineUsersList) {
          onlineUsersList.innerHTML = '';
          
          if (users.length === 0) {
            onlineUsersList.innerHTML = '<div class="user-pill">No users online</div>';
          } else {
            users.forEach(user => {
              const userPill = document.createElement('div');
              userPill.className = 'user-pill';
              userPill.textContent = user.username.replace(/^admin_/, ''); // Remove admin_ prefix if present
              onlineUsersList.appendChild(userPill);
            });
          }
        }
      });
      
      // Handle chat messages
      socket.on('chat:message', (message) => {
        addChatMessage(message);
      });
      
      // Handle admin broadcast events
      socket.on('admin:broadcast', (data) => {
        addSystemMessage(`Broadcast: ${data.message}`);
      });
      
      // Send message handler
      if (sendMessageBtn && chatInput) {
        sendMessageBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            sendMessage();
          }
        });
      }
      
      // Function to send chat message
      function sendMessage() {
        const messageText = chatInput.value.trim();
        
        if (messageText) {
          // Emit message event
          socket.emit('chat:message', {
            content: messageText,
            isAdmin: true // Mark as admin message
          });
          
          // Clear input
          chatInput.value = '';
          
          // Focus back on input
          chatInput.focus();
        }
      }
      
      // Function to add chat message to UI
      function addChatMessage(message) {
        if (!chatMessages) return;
        
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message';
        
        // Check if this is from the current user
        if (message.userId === socketClient.userId) {
          messageDiv.classList.add('self');
        }
        
        messageDiv.innerHTML = `
          <div class="message-content-wrapper">
            <div class="message-header">
              <span class="message-sender">${message.username}${message.isAdmin ? ' (Admin)' : ''}</span>
              <span class="message-time">${formatMessageTime(message.timestamp)}</span>
            </div>
            <div class="message-content">${message.content}</div>
          </div>
        `;
        
        chatMessages.appendChild(messageDiv);
        
        // Scroll to bottom
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
      
      // Function to add system message
      function addSystemMessage(message) {
        if (!chatMessages) return;
        
        const systemDiv = document.createElement('div');
        systemDiv.className = 'system-message';
        systemDiv.innerHTML = `
          <div class="message-content">${message}</div>
        `;
        
        chatMessages.appendChild(systemDiv);
        
        // Scroll to bottom
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
      
      // Function to format message time
      function formatMessageTime(timestamp) {
        const date = new Date(timestamp);
        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      }
    }
  </script>
  
  <!-- Make AI services globally available -->
  <script>
    // Global AI services container
    window.aiService = null;
    window.similarityService = null;
    
    // Initialize services when scripts are loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Import modules and make them globally available
      import('/interac/client-side/admin/service/ai-service.js')
        .then(module => {
          window.aiService = module.aiService;
          console.log('AI service loaded globally');
        })
        .catch(err => console.error('Failed to load AI service:', err));
        
      import('/interac/client-side/admin/service/ai-similarity-service.js')
        .then(module => {
          window.similarityService = module.similarityService;
          console.log('Similarity service loaded globally');
        })
        .catch(err => console.error('Failed to load similarity service:', err));
    });
  </script>
  
  <!-- Link to our modern VA quiz admin UI JavaScript -->
  <script src="/interac/client-side/admin/modern-admin-ui.js"></script>
</body>
</html>< l i n k   r e l = \ 
 
 s t y l e s h e e t \   h r e f = \ / i n t e r a c / c l i e n t - s i d e / c l i e n t - s t y l e s / q u i z - d e s i g n e r . c s s \ > 
 
 